<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ScanGame — Layered Detection</title>
  </head>
  <body>
    <div style="display:flex; flex-direction:column; gap:16px; align-items:center; justify-content:flex-start; padding:12px; width:100%;">
      <div id="menu" style="position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.6); z-index:10;">
        <div style="background:#0b1020; border:1px solid #1f2a44; padding:16px 20px; border-radius:8px; color:#cfe8ff; font-family:monospace; min-width:360px;">
          <div style="font-size:18px; margin-bottom:8px;">Select your ship</div>
          <div id="ship-list" style="display:flex; flex-direction:column; gap:8px;"></div>
          <div style="margin-top:12px; font-size:12px; opacity:0.8;">W/S throttle, A/D rotate, Q/E arc, Space ping, Shift dark-run</div>
        </div>
      </div>
      <div id="app"></div>
      <div id="tutorial" style="padding: 24px;max-width:980px; color:#cfe9ff; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size:14px; line-height:1.5; text-align:left;">
        <h2 style="margin:0 0 8px 0; font-size:16px; color:#9ad0ff;">How to Play</h2>
        <p style="margin:0 0 8px 0;"><b>Before you start</b>: Pick a ship in the menu.
          <span style="opacity:0.9;">Classes change:</span>
          <br/>- <b>Speed/Acceleration</b> (handling)
          <br/>- <b>Baseline Noise</b> (how loud you idle/coast)
          <br/>- <b>Passive / Active base ranges</b> (sensor strength)
          <br/><span style="opacity:0.9;">Rule of thumb:</span> Frigate = faster/stealthier (shorter base ranges). Capital = slower/louder (longer base ranges).</p>
        <ul style="margin:0 8px 10px 18px; padding:0;">
          <li><b>Rotate</b>: A / D</li>
          <li><b>Throttle</b>: W / S — Thrust raises your <b>Noise Index (NI)</b>; coasting lowers it. Higher NI makes <i>you</i> detectable from farther away by others.</li>
          <li><b>Passive Arc</b>: Q / E — This controls your directional scan.
            <ul style="margin:4px 0 0 16px;">
              <li>Arc width range: <b>30°–180°</b>.</li>
              <li><b>Narrower arc</b> → higher listening gain (detect farther) and smaller error; <b>wider arc</b> → more coverage but shorter reach and fuzzier hits.</li>
              <li><b>No fixed range</b>: detections happen when received signal passes a threshold (based on distance, target loudness/size, and arc gain).</li>
              <li>Accuracy: error shrinks as signal-to-noise improves (closer, louder target, or narrower arc).</li>
              <li>Cost: each Passive return emits a small <b>reveal bubble</b>. Bubble size grows with arc width. Internally throttled ~<b>1.2 s</b>.</li>
            </ul>
          </li>
          <li><b>Active Ping</b>: Space — Emits a pulse revealing <b>exact</b> positions when the return passes the threshold (stronger up close, weaker far away).
            <ul style="margin:4px 0 0 16px;">
              <li><b>Cooldown</b>: ~<b>5 s</b> (see HUD bar). Contacts remain visible ~<b>1.2 s</b>.</li>
              <li><b>Risk</b>: creates a <b>large reveal bubble</b> and briefly spikes your NI (you become much easier to detect).</li>
              <li>Best used after Passive triangulation to confirm intercept.</li>
            </ul>
          </li>
          <li><b>Dark Run</b>: hold Shift — Reduces emitted NI to help you hide; works best when coasting and inside cover.</li>
          <li><b>Zoom</b>: Mouse wheel over the canvas — Zoom in/out around your ship (for situational awareness).</li>
        </ul>
        <p style="margin:0 0 8px 0;"><b>Objective</b>: Track with Passive + breadcrumbs; when you’re close, Ping to confirm and win. If the prey reaches the green gate before time ends, you lose.</p>
        <div style="margin:8px 0 8px 0;">
          <div style="margin:0 0 4px 0;"><b>Visuals</b></div>
          <ul style="margin:0 0 6px 18px; padding:0;">
            <li>Rings: <b>reference</b> Ambient/Passive/Active radii (thin). Real detection uses thresholds, so you can sometimes detect past a ring (loud target, narrow arc) or inside it (quiet target, cover).</li>
            <li>Arc wedge: Passive field-of-view; detections occur inside the wedge when the signal crosses threshold.</li>
            <li>Breadcrumbs: <span style="color:#79c6ff">blue</span> = passive (approximate), <span style="color:#ffc04d">orange</span> = decoys</li>
            <li>Red circles: reveal bubbles — small (Passive ticks), large (Active ping)</li>
          </ul>
        </div>
        <div style="margin:8px 0 0 0;">
          <div style="margin:0 0 4px 0;"><b>Scanning & Detectability (Threshold Model)</b></div>
          <ul style="margin:0 0 6px 18px; padding:0;">
            <li><b>Ambient</b> (always on): hint appears when NI×size ÷ distance² clears a threshold. Ignores arc.</li>
            <li><b>Passive</b> (Arc): inside the wedge, a return appears when (NI×size×arc gain) ÷ distance² clears a threshold. Narrower arc = higher gain and smaller error. Drops <b>blue breadcrumbs</b> (~8 s).</li>
            <li><b>Active</b> (Ping): exact positions when two-way strength (∝ 1/distance⁴) clears a threshold; large reveal pulse; cooldown applies.</li>
            <li><b>Cover and noise</b>: zones reduce NI (harder to detect); thrust/weapons/pings raise NI (easier to detect).</li>
          </ul>
        </div>
        <p style="margin:8px 0 0 0;"><b>Tips</b>: Sweep wide to find direction, narrow Arc to triangulate, then Ping. Use zones (shadows/thermal/clutter) to cut NI and break locks.</p>
      </div>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
